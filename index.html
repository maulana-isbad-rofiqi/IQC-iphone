<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IQC iPhone Generator Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: #000;
            --panel: #1c1c1e;
            --border: #38383a;
            --accent: #0a84ff;
            --text: #fff;
            --text-dim: #8e8e93;
            --danger: #ff453a;
            --wa-bubble-dark: #202c33;
            --wa-green-dark: #005c4b;
            --ios-menu-bg: #252525;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }

        body {
            background: #111;
            color: var(--text);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .container {
            display: flex;
            width: 100%;
            max-width: 1400px;
            height: 95vh;
            background: var(--bg);
            border-radius: 20px;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            overflow: hidden;
            border: 1px solid #333;
        }

        @media (max-width: 768px) { .container { flex-direction: column; height: 100vh; max-width: 100%; border-radius: 0; } }

        /* Sidebar Controls */
        .controls {
            width: 360px; background: var(--panel); border-right: 1px solid var(--border); padding: 20px;
            display: flex; flex-direction: column; gap: 15px; overflow-y: auto;
        }
        @media (max-width: 768px) { .controls { width: 100%; border-right: none; border-bottom: 1px solid var(--border); max-height: 40vh; } }

        .header-control h1 { font-size: 20px; margin-bottom: 5px; }
        .header-control span { color: var(--accent); }
        .header-control p { font-size: 12px; color: var(--text-dim); }
        .tabs { display: flex; gap: 5px; background: #2c2c2e; padding: 3px; border-radius: 8px; }
        .tab-btn { flex: 1; padding: 8px; background: none; border: none; color: var(--text-dim); cursor: pointer; border-radius: 6px; font-weight: 600; font-size: 13px; }
        .tab-btn.active { background: #636366; color: #fff; }
        .panel-section h3, .panel h3 { font-size: 11px; text-transform: uppercase; color: var(--text-dim); margin-bottom: 8px; letter-spacing: 0.5px; }
        .panel { display: none; flex-direction: column; gap: 15px; }
        .panel.active { display: flex; }
        .input-group { display: flex; flex-direction: column; gap: 5px; margin-bottom: 10px; }
        .input-group label { font-size: 12px; color: var(--text-dim); }
        .input-row { display: flex; gap: 10px; align-items: center; }
        input, textarea, select { background: #2c2c2e; border: 1px solid var(--border); color: #fff; padding: 10px; border-radius: 8px; font-size: 13px; outline: none; width: 100%; }
        input:focus { border-color: var(--accent); }
        .divider { height: 1px; background: var(--border); margin: 5px 0; }
        .btn-add { background: #3a3a3c; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: 600; width: 100%; }
        .btn-add:hover { background: #48484a; }
        .btn-primary { background: var(--accent); color: white; border: none; padding: 14px; border-radius: 10px; cursor: pointer; font-weight: 600; width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary:hover { opacity: 0.9; }
        .copyright { font-size: 11px; color: var(--text-dim); text-align: center; margin-top: 10px; }
        .message-list { display: flex; flex-direction: column; gap: 8px; max-height: 250px; overflow-y: auto; padding-right: 5px; }
        .list-item { background: #252525; padding: 8px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; font-size: 12px; border: 1px solid #333; }
        .list-text { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 180px; }
        .list-actions { display: flex; gap: 5px; }
        .btn-icon { background: none; border: none; cursor: pointer; font-size: 14px; padding: 2px; opacity: 0.7; }
        .btn-icon:hover { opacity: 1; }
        .btn-del { color: var(--danger); }

        /* PREVIEW AREA */
        .preview { flex: 1; display: flex; justify-content: center; align-items: center; background: #1a1a1a; padding: 20px; overflow: auto; }
        @media (max-width: 768px) { .preview { padding: 10px; background: #1a1a1a; align-items: flex-start; } }

        .phone-frame {
            width: 320px; height: 693px; background: #000; position: relative; overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        @media (max-width: 768px) { .phone-frame { width: 100%; max-width: 320px; height: auto; aspect-ratio: 9/19.5; } }

        .status-bar { position: absolute; top: 10px; width: 100%; padding: 0 25px; display: flex; justify-content: space-between; color: white; font-weight: 600; font-size: 15px; z-index: 998; }
        .status-icons { display: flex; gap: 5px; align-items: center; }
        .status-icons svg { width: 18px; height: 18px; }
        .battery { width: 27px; height: 13px; border: 1.5px solid rgba(255,255,255,0.4); border-radius: 3px; display: flex; align-items: center; position: relative; }
        .battery-fill { background: white; height: 100%; border-radius: 1.5px; display: flex; align-items: center; justify-content: center; }
        .battery-tip { width: 2px; height: 5px; background: rgba(255,255,255,0.4); position: absolute; right: -3.5px; top: 50%; transform: translateY(-50%); border-radius: 0 2px 2px 0; }
        #disp-batt-num { font-size: 8px; font-weight: 600; color: #000; position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); line-height: 1; z-index: 1; }

        .screen-content { width: 100%; height: 100%; position: absolute; top: 0; left: 0; display: none; }
        .screen-content.active { display: block; }

        /* THEMES */
        .phone-frame.theme-light .status-bar { color: black; }
        .phone-frame.theme-light .battery { border-color: rgba(0,0,0,0.3); }
        .phone-frame.theme-light .battery-tip { background: rgba(0,0,0,0.3); }
        .phone-frame.theme-light .battery-fill { background: black; }
        .phone-frame.theme-light #disp-batt-num { color: #fff; }
        .phone-frame.theme-light #view-whatsapp .wa-header { background: rgba(244, 244, 244, 0.98); border-bottom: 1px solid #b2b2b2; }
        .phone-frame.theme-light #view-whatsapp .wa-name { color: black; }
        .phone-frame.theme-light #view-whatsapp .wa-status { color: #666; }
        .phone-frame.theme-light #view-whatsapp .bubble-left { background: #ffffff; color: black; }
        .phone-frame.theme-light #view-whatsapp .bubble-time { color: rgba(0, 0, 0, 0.45); }
        .phone-frame.theme-light #view-whatsapp .bubble-left::before { background: radial-gradient(circle at 0 0, transparent 0, transparent 11px, #ffffff 11px); }
        .phone-frame.theme-light #view-whatsapp .bubble-right { background: #e2ffc7; color: black; }
        .phone-frame.theme-light #view-whatsapp .bubble-right::after { background: #e2ffc7; }
        .phone-frame.theme-light #view-whatsapp .wa-footer { background: #f6f6f6; border-top: 1px solid #b2b2b2; }
        .phone-frame.theme-light #view-whatsapp .wa-input-mock { background: white; border: 1px solid #ccc; }
        .phone-frame.theme-light #view-whatsapp .wa-icon { stroke: #007aff; }
        .phone-frame.theme-light .home-bar { background: black; }
        .phone-frame.theme-light .reaction-bar, .phone-frame.theme-light .ctx-menu { background: #fff; color: black; }
        .phone-frame.theme-light .ctx-item { color: black; border-bottom: 1px solid #eee; }
        .phone-frame.theme-light .reaction-more { background: #f0f0f0; }

        /* LOCK SCREEN (Standard) */
        .ls-header { padding-top: 60px; text-align: center; color: white; display: flex; flex-direction: column; align-items: center; }
        .ls-date { font-size: 20px; font-weight: 400; margin-bottom: 5px; opacity: 0.9; }
        .ls-clock { font-size: 84px; font-weight: 600; line-height: 1; letter-spacing: -2px; }
        .ls-notification { width: 90%; margin: 20px auto; background: rgba(255,255,255,0.15); backdrop-filter: blur(25px); border-radius: 18px; padding: 12px 15px; }
        .notif-top { display: flex; align-items: center; margin-bottom: 8px; }
        .notif-icon { width: 20px; height: 20px; background: #34c759; border-radius: 5px; padding: 3px; margin-right: 8px; display: flex; align-items: center; justify-content: center; }
        .notif-icon svg { display: block; width: 100%; height: 100%; }
        .notif-app { font-size: 12px; font-weight: 600; color: rgba(255,255,255,0.8); flex: 1; }
        .notif-ago { font-size: 12px; color: rgba(255,255,255,0.6); }
        .notif-body strong { display: block; font-size: 14px; margin-bottom: 2px; }
        .notif-body p { font-size: 14px; margin: 0; line-height: 1.3; }
        .ls-footer-actions { position: absolute; bottom: 40px; width: 100%; display: flex; justify-content: space-between; align-items: center; padding: 0 45px; pointer-events: none; }
        .circle-btn { width: 50px; height: 50px; background: rgba(255,255,255,0.15); border-radius: 50%; display: flex; justify-content: center; align-items: center; backdrop-filter: blur(10px); }
        .circle-btn svg { width: 24px; height: 24px; }
        .ls-name-display { font-size: 14px; font-weight: 500; color: white; text-align: center; flex: 1; max-width: 150px; }

        /* WHATSAPP ELEMENTS */
        .wa-header { position: absolute; top: 0; width: 100%; height: 105px; background: rgba(22, 28, 33, 0.95); backdrop-filter: blur(20px); display: flex; align-items: flex-end; padding: 10px 12px; border-bottom: 1px solid #232d36; z-index: 90; }
        .wa-back-btn { display: flex; align-items: center; color: var(--accent); font-size: 17px; gap: 5px; margin-right: 5px; margin-bottom: 8px; font-weight: 400; }
        .wa-back-btn svg { width: 24px; height: 24px; stroke-width: 2.5; }
        .wa-profile { flex: 1; display: flex; align-items: center; gap: 10px; margin-bottom: 6px; padding-left: 5px; }
        .wa-pp { width: 38px; height: 38px; border-radius: 50%; overflow: hidden; background: #666; flex-shrink: 0; }
        .wa-info { display: flex; flex-direction: column; justify-content: center; }
        .wa-name { font-size: 16px; font-weight: 600; color: white; line-height: 1.2; }
        .wa-status { font-size: 12px; color: #8e8e93; margin-top: 1px; line-height: 1.2; }
        .wa-calls { display: flex; gap: 22px; margin-bottom: 13px; margin-right: 10px; }
        .wa-calls svg { width: 22px; height: 22px; stroke-width: 1.5; }
        .wa-chat-container { padding: 115px 16px 90px 16px; height: 100%; overflow-y: auto; display: flex; flex-direction: column; gap: 2px; }

        /* BUBBLES */
        .bubble { max-width: 78%; padding: 6px 12px 8px 12px; border-radius: 16px; font-size: 16px; position: relative; line-height: 1.35; color: white; word-wrap: break-word; margin-bottom: 8px; box-shadow: 0 1px 0.5px rgba(0,0,0,0.13); }
        .bubble-left { align-self: flex-start; background: var(--wa-bubble-dark); border-top-left-radius: 2px; margin-left: 8px; }
        .bubble-left::before { content: ""; position: absolute; top: 0; left: -8px; width: 12px; height: 20px; background: radial-gradient(circle at 0 0, transparent 0, transparent 11px, var(--wa-bubble-dark) 11px); clip-path: polygon(0 0, 100% 0, 100% 100%); }
        .bubble-right { align-self: flex-end; background: var(--wa-green-dark); border-top-right-radius: 2px; margin-right: 8px; }
        .bubble-right::after { content: ""; position: absolute; top: 0; right: -8px; width: 8px; height: 13px; background: var(--wa-green-dark); border-bottom-left-radius: 20px; z-index: -1; }
        .bubble-meta { display: flex; justify-content: flex-end; align-items: center; gap: 4px; margin-top: 2px; margin-bottom: -3px; margin-right: -4px; float: right; margin-left: 8px; padding-top: 6px; }
        .bubble-time { font-size: 11px; color: rgba(255,255,255,0.6); }
        .bubble-check svg { width: 16px; height: 16px; display: block; }

        /* --- REACTION & MENU STYLE (EXACT IPHONE MATCH) --- */
        
        /* Dark Overlay (Simulasi Fokus/Blur untuk html2canvas) */
        .wa-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.75); /* Hitam transparan agar bubble sorot terlihat */
            opacity: 0; pointer-events: none; transition: opacity 0.2s; z-index: 200;
        }
        .wa-overlay.active { opacity: 1; pointer-events: auto; }

        /* Highlight Bubble (Focus) */
        .bubble.active-press {
            z-index: 201;
            transform: scale(1.01);
            box-shadow: none; /* Hilangkan shadow agar menyatu */
        }

        /* REACTION BAR */
        .reaction-bar {
            position: absolute; height: 48px;
            background: var(--ios-menu-bg);
            border-radius: 24px;
            display: flex; align-items: center; padding: 0 12px; gap: 4px;
            z-index: 202; animation: popIn 0.2s cubic-bezier(0.17, 0.84, 0.44, 1);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        /* Emoji Image Style */
        .reaction { 
            width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; 
            cursor: pointer; transition: 0.2s; 
        }
        .reaction img { width: 100%; height: 100%; display: block; filter: drop-shadow(0 1px 2px rgba(0,0,0,0.2)); }
        .reaction:hover { transform: scale(1.2); }

        .reaction-more { 
            width: 32px; height: 32px; border-radius: 50%; background: #3a3a3a;
            display: flex; align-items: center; justify-content: center; margin-left: 4px;
        }
        .reaction-more svg { width: 20px; height: 20px; fill: #8e8e93; }

        /* CONTEXT MENU */
        .ctx-menu {
            position: absolute; width: 220px;
            background: var(--ios-menu-bg);
            border-radius: 14px; z-index: 202; overflow: hidden;
            animation: fadeUp 0.2s ease;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
        }
        .ctx-item {
            padding: 14px 16px; color: white; font-size: 16px; font-weight: 400;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.12); background: transparent;
        }
        .ctx-item:last-child { border-bottom: none; }
        .ctx-item.danger { color: var(--danger); }
        .ctx-item svg { width: 18px; height: 18px; opacity: 1; stroke-width: 1.5; stroke: currentColor; fill: none; }

        .wa-footer { position: absolute; bottom: 0; width: 100%; height: 80px; background: #1f2c34; display: flex; align-items: flex-start; padding: 12px 15px; gap: 15px; z-index: 91; }
        .wa-input-mock { flex: 1; height: 35px; background: #2c3e50; border-radius: 18px; }
        .wa-icon { width: 26px; height: 26px; margin-top: 4px; }
        .home-bar { position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); width: 120px; height: 5px; background: white; border-radius: 3px; z-index: 999; }

        @keyframes popIn { from { opacity: 0; transform: scale(0.5) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="container">
        <aside class="controls">
            <div class="header-control">
                <h1>IQC <span>iPhone</span></h1>
                <p>Generator Mockup Pro</p>
            </div>
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('lockscreen')">Lock Screen</button>
                <button class="tab-btn" onclick="switchTab('whatsapp')">WhatsApp</button>
            </div>
            <div class="panel-section">
                <h3>Status Bar</h3>
                <div class="input-row"><input type="time" id="sys-time" value="09:41"><div class="battery-control"><input type="number" id="sys-battery" min="1" max="100" value="100" placeholder="%"><span>%</span></div></div>
            </div>
            <div class="panel-section">
                <h3>Tema Tampilan</h3>
                <select id="sys-theme"><option value="dark">Mode Gelap (Dark)</option><option value="light">Mode Terang (Light)</option></select>
            </div>

            <div id="panel-lockscreen" class="panel active">
                <h3>Konten Lock Screen</h3>
                <div class="input-group"><label>Nama</label><input type="text" id="ls-operator" placeholder="Nama Anda"></div>
                <div class="input-group"><label>Tanggal</label><input type="text" id="ls-date" value="Senin, 1 Januari"></div>
                <div class="divider"></div>
                <h3>Wallpaper</h3>
                <div class="input-group"><select id="ls-wallpaper"><option value="gradient1">Gradient Biru-Hitam</option><option value="custom">Upload Gambar</option></select></div>
                <div class="input-group" id="wallpaper-upload-group" style="display:none;"><input type="file" id="ls-wallpaper-input" accept="image/*"></div>
                <div class="divider"></div>
                <div class="input-group"><label>Pesan Notif</label><textarea id="ls-message" rows="2">Kangen kamu...</textarea></div>
            </div>

            <div id="panel-whatsapp" class="panel">
                <h3>Profil</h3>
                <div class="input-group"><label>Nama</label><input type="text" id="wa-name" value="Sayang"></div>
                <div class="input-group"><label>Status</label><input type="text" id="wa-status" value="Online"></div>
                <div class="input-group"><label>Foto</label><input type="file" id="wa-avatar-input" accept="image/*"></div>
                <div class="divider"></div>
                <h3>Chat</h3>
                <div class="input-group"><textarea id="wa-input-msg" rows="2" placeholder="Pesan..."></textarea></div>
                <div class="input-row">
                    <input type="time" id="wa-input-time" value="09:41">
                    <select id="wa-input-pos"><option value="left">Kiri</option><option value="right">Kanan</option></select>
                </div>
                <div class="input-group" id="wa-check-group" style="display:none;">
                    <select id="wa-input-check"><option value="read">Centang Biru</option><option value="delivered">Centang Abu</option></select>
                </div>
                <button class="btn-add" onclick="addMessage()">Kirim</button>
                <div class="divider"></div>
                <h3>Daftar Pesan</h3>
                <p class="hint">Klik ðŸ‘† untuk menu iPhone.</p>
                <div id="message-list" class="message-list"></div>
            </div>

            <div class="footer-control">
                <button id="btn-download" class="btn-primary">Download Gambar</button>
                <div class="copyright">&copy; 2025 IQC iPhone</div>
            </div>
        </aside>

        <main class="preview">
            <div class="phone-frame" id="capture-area">
                <div class="status-bar">
                    <div class="time" id="disp-sys-time">09:41</div><div class="dynamic-island"></div>
                    <div class="status-icons">
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17,7H22V20H17V7M10,13H15V20H10V13M3,16H8V20H3V16Z"/></svg>
                        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z"/></svg>
                        <div class="battery"><div class="battery-fill" id="disp-sys-battery" style="width:100%"></div><div class="battery-tip"></div></div>
                        <span id="disp-batt-num" style="margin-left:4px;font-size:12px;">100</span>
                    </div>
                </div>

                <div id="view-lockscreen" class="screen-content active" style="background: #000;">
                    <div class="ls-header"><div class="ls-clock" id="disp-ls-clock">09:41</div><div id="disp-ls-date">Senin, 1 Jan</div></div>
                    <div class="home-bar"></div>
                </div>

                <div id="view-whatsapp" class="screen-content" style="background: #0b141a;">
                    <div class="wa-header">
                        <div class="wa-back-btn"><svg viewBox="0 0 24 24" fill="#0a84ff"><path d="M11.67 3.87L9.9 2.1 0 12l9.9 9.9 1.77-1.77L3.54 12z"/></svg><span>9</span></div>
                        <div class="wa-profile">
                            <div class="wa-pp"><img id="disp-wa-avatar" src="" style="display:none; width:100%; height:100%; object-fit:cover;"></div>
                            <div class="wa-info"><div class="wa-name" id="disp-wa-name">Sayang</div><div class="wa-status" id="disp-wa-status">Online</div></div>
                        </div>
                    </div>
                    <div class="wa-chat-container" id="wa-chat-list"></div>
                    <div class="wa-footer">
                        <svg class="wa-icon" viewBox="0 0 24 24" stroke="#0a84ff"><path d="M12 5v14M5 12h14" stroke-width="1.5"/></svg>
                        <div class="wa-input-mock"></div>
                        <svg class="wa-icon" viewBox="0 0 24 24" stroke="#0a84ff"><circle cx="12" cy="12" r="9" stroke-width="1.5"/></svg>
                        <svg class="wa-icon" viewBox="0 0 24 24" stroke="#0a84ff"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z" stroke-width="1.5"/></svg>
                    </div>
                    <div class="home-bar"></div>
                    <div id="wa-overlay" class="wa-overlay"></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const state = { messages: [], mode: 'lockscreen' };
        const els = {
            sysTime: document.getElementById('sys-time'), waChatList: document.getElementById('wa-chat-list'), overlay: document.getElementById('wa-overlay')
        };

        // URL Emojis Apple (CDN)
        const emojis = [
            'https://em-content.zobj.net/source/apple/391/thumbs-up_1f44d.png',
            'https://em-content.zobj.net/source/apple/391/red-heart_2764-fe0f.png',
            'https://em-content.zobj.net/source/apple/391/face-with-tears-of-joy_1f602.png',
            'https://em-content.zobj.net/source/apple/391/face-with-open-mouth_1f62e.png',
            'https://em-content.zobj.net/source/apple/391/crying-face_1f622.png',
            'https://em-content.zobj.net/source/apple/391/folded-hands_1f64f.png'
        ];

        function init() {
            els.sysTime.addEventListener('input', (e) => { 
                document.querySelectorAll('#disp-sys-time, #disp-ls-clock').forEach(el => el.textContent = e.target.value); 
            });
            document.getElementById('wa-input-pos').addEventListener('change', (e) => {
                document.getElementById('wa-check-group').style.display = e.target.value === 'right' ? 'flex' : 'none';
            });
            els.overlay.addEventListener('click', closeReactionMode);
            document.getElementById('btn-download').addEventListener('click', downloadImage);
            
            // Init tabs
            document.querySelectorAll('.tab-btn').forEach(btn => btn.addEventListener('click', (e) => {
                document.querySelectorAll('.tab-btn, .panel, .screen-content').forEach(el => el.classList.remove('active'));
                e.target.classList.add('active');
                const mode = e.target.textContent.includes('Lock') ? 'lockscreen' : 'whatsapp';
                document.getElementById(`panel-${mode}`).classList.add('active');
                document.getElementById(`view-${mode}`).classList.add('active');
            }));
        }

        function addMessage() {
            const txt = document.getElementById('wa-input-msg').value;
            if(!txt) return;
            state.messages.push({ 
                id: Date.now(), text: txt, 
                time: document.getElementById('wa-input-time').value, 
                pos: document.getElementById('wa-input-pos').value,
                check: document.getElementById('wa-input-check').value 
            });
            renderMessages();
            document.getElementById('wa-input-msg').value = '';
        }

        function renderMessages() {
            els.waChatList.innerHTML = '';
            const listSide = document.getElementById('message-list');
            listSide.innerHTML = '';

            state.messages.forEach(msg => {
                // Render Sidebar Item
                const li = document.createElement('div'); li.className = 'list-item';
                li.innerHTML = `<div class="list-text">${msg.text}</div><div class="list-actions"><button class="btn-icon" onclick="activateReactionMode(${msg.id})">ðŸ‘†</button><button class="btn-icon btn-del" onclick="deleteMsg(${msg.id})">âœ•</button></div>`;
                listSide.appendChild(li);

                // Render Bubble
                const b = document.createElement('div'); b.className = `bubble bubble-${msg.pos}`; b.id = `msg-${msg.id}`;
                let chk = '';
                if(msg.pos === 'right') {
                    const color = msg.check === 'read' ? '#53bdeb' : '#8696a0';
                    chk = `<svg viewBox="0 0 24 24" fill="none" stroke="${color}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width:16px;height:16px;"><polyline points="20 6 9 17 4 12"/></svg>`;
                }
                b.innerHTML = `${msg.text}<div class="bubble-meta"><span class="bubble-time">${msg.time}</span><div class="bubble-check">${chk}</div></div>`;
                els.waChatList.appendChild(b);
            });
        }

        window.deleteMsg = (id) => { state.messages = state.messages.filter(m => m.id !== id); renderMessages(); closeReactionMode(); };

        window.activateReactionMode = (id) => {
            closeReactionMode();
            const b = document.getElementById(`msg-${id}`); if(!b) return;
            els.overlay.classList.add('active'); b.classList.add('active-press');
            
            const top = b.offsetTop;
            const isRight = b.classList.contains('bubble-right');

            // INJECT REACTION BAR (IMAGES)
            const r = document.createElement('div'); r.className = 'reaction-bar temp-ui';
            // Loop emoji images
            let htmlEmojis = '';
            emojis.forEach(url => htmlEmojis += `<div class="reaction"><img src="${url}"></div>`);
            
            r.innerHTML = htmlEmojis + `<div class="reaction reaction-more"><svg viewBox="0 0 24 24"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></div>`;
            
            r.style.top = (top - 55) + 'px';
            if(isRight) { r.style.right = '15px'; r.style.transformOrigin = 'bottom right'; } 
            else { r.style.left = '15px'; r.style.transformOrigin = 'bottom left'; }
            els.waChatList.appendChild(r);

            // INJECT MENU (EXACT IOS TEXT & ICONS)
            const m = document.createElement('div'); m.className = 'ctx-menu temp-ui';
            m.innerHTML = `
                <div class="ctx-item">Balas <svg viewBox="0 0 24 24"><path d="M9 14L4 9l5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M4 9h10c4 0 7 3 7 7v1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
                <div class="ctx-item">Teruskan <svg viewBox="0 0 24 24"><path d="M15 14l5-5-5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M4 20v-1c0-4 3-7 7-7h9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></div>
                <div class="ctx-item">Salin <svg viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg></div>
                <div class="ctx-item">Tanya Meta AI <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg></div>
                <div class="ctx-item danger">Hapus <svg viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></div>
                <div class="ctx-item">Lainnya... <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="1" fill="currentColor"/><circle cx="19" cy="12" r="1" fill="currentColor"/><circle cx="5" cy="12" r="1" fill="currentColor"/></svg></div>
            `;
            m.style.top = (top + b.offsetHeight + 10) + 'px';
            if(isRight) { m.style.right = '15px'; m.style.transformOrigin = 'top right'; } 
            else { m.style.left = '15px'; m.style.transformOrigin = 'top left'; }
            els.waChatList.appendChild(m);
        }

        function closeReactionMode() {
            els.overlay.classList.remove('active');
            document.querySelectorAll('.active-press').forEach(el => el.classList.remove('active-press'));
            document.querySelectorAll('.temp-ui').forEach(el => el.remove());
        }

        function downloadImage() {
            const btn = document.getElementById('btn-download');
            const txt = btn.innerText;
            btn.innerText = 'Memproses...';
            setTimeout(() => {
                html2canvas(document.getElementById('capture-area'), { 
                    scale: 2, backgroundColor: null, useCORS: true 
                }).then(canvas => {
                    const a = document.createElement('a');
                    a.download = 'IQC-iPhone.png';
                    a.href = canvas.toDataURL("image/png");
                    a.click();
                    btn.innerText = txt;
                });
            }, 100);
        }

        init();
    </script>
</body>
</html>
