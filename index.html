<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IQC iPhone Generator Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style>
        /* --- CSS RESET & VARIABLES --- */
        :root {
            --bg: #000;
            --panel: #1c1c1e;
            --border: #38383a;
            --accent: #0a84ff;
            --text: #fff;
            --text-dim: #8e8e93;
            --danger: #ff453a;
            --wa-bubble-dark: #202c33;
            --wa-green-dark: #005c4b;
            --ios-menu-bg: #252525; /* Warna Solid untuk Menu */
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', -apple-system, sans-serif; }

        body {
            background: #111;
            color: var(--text);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* --- LAYOUT UTAMA (KEMBALI KE VERSI RAPI) --- */
        .container {
            display: flex;
            width: 100%;
            max-width: 1400px;
            height: 95vh;
            background: var(--bg);
            border-radius: 20px;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            overflow: hidden;
            border: 1px solid #333;
        }

        /* Sidebar */
        .controls {
            width: 360px;
            min-width: 360px; /* Fix lebar sidebar */
            background: var(--panel);
            border-right: 1px solid var(--border);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            overflow-y: auto;
        }

        .header-control h1 { font-size: 20px; margin-bottom: 5px; }
        .header-control span { color: var(--accent); }
        .header-control p { font-size: 12px; color: var(--text-dim); }

        .tabs { display: flex; gap: 5px; background: #2c2c2e; padding: 3px; border-radius: 8px; flex-shrink: 0; }
        .tab-btn { flex: 1; padding: 8px; background: none; border: none; color: var(--text-dim); cursor: pointer; border-radius: 6px; font-weight: 600; font-size: 13px; }
        .tab-btn.active { background: #636366; color: #fff; }

        .panel { display: none; flex-direction: column; gap: 15px; }
        .panel.active { display: flex; }

        .input-group { display: flex; flex-direction: column; gap: 5px; margin-bottom: 10px; }
        .input-group label { font-size: 12px; color: var(--text-dim); }
        .input-row { display: flex; gap: 10px; align-items: center; }

        input, textarea, select {
            background: #2c2c2e; border: 1px solid var(--border); color: #fff;
            padding: 10px; border-radius: 8px; font-size: 13px; outline: none; width: 100%;
        }
        .divider { height: 1px; background: var(--border); margin: 5px 0; }
        .btn-add { background: #3a3a3c; color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; width: 100%; }
        .btn-primary { background: var(--accent); color: white; border: none; padding: 14px; border-radius: 10px; cursor: pointer; width: 100%; font-weight: 600; }
        
        .message-list { display: flex; flex-direction: column; gap: 8px; max-height: 250px; overflow-y: auto; }
        .list-item { background: #252525; padding: 8px; border-radius: 6px; display: flex; justify-content: space-between; border: 1px solid #333; font-size: 12px; }

        /* --- PREVIEW AREA --- */
        .preview {
            flex: 1;
            background: #151515;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            overflow: auto;
            position: relative;
        }

        .phone-frame {
            width: 320px;
            height: 693px;
            background: #000;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 0 10px #000, 0 0 0 12px #333, 0 20px 40px rgba(0,0,0,0.5);
            border-radius: 40px; /* Sudut HP melengkung */
            flex-shrink: 0;
        }

        /* TEMA LIGHT */
        .phone-frame.theme-light .status-bar { color: black; }
        .phone-frame.theme-light .battery { border-color: rgba(0,0,0,0.3); }
        .phone-frame.theme-light .battery-fill { background: black; }
        .phone-frame.theme-light #disp-batt-num { color: #fff; }
        .phone-frame.theme-light #view-whatsapp .wa-header { background: rgba(244, 244, 244, 0.98); border-bottom: 1px solid #b2b2b2; }
        .phone-frame.theme-light #view-whatsapp .wa-name { color: black; }
        .phone-frame.theme-light #view-whatsapp .wa-status { color: #666; }
        .phone-frame.theme-light #view-whatsapp .bubble-left { background: #ffffff; color: black; }
        .phone-frame.theme-light #view-whatsapp .bubble-time { color: rgba(0, 0, 0, 0.45); }
        .phone-frame.theme-light #view-whatsapp .bubble-left::before { background: radial-gradient(circle at 0 0, transparent 0, transparent 11px, #ffffff 11px); }
        .phone-frame.theme-light #view-whatsapp .bubble-right { background: #e2ffc7; color: black; }
        .phone-frame.theme-light #view-whatsapp .bubble-right::after { background: #e2ffc7; }
        .phone-frame.theme-light #view-whatsapp .wa-footer { background: #f6f6f6; border-top: 1px solid #b2b2b2; }
        .phone-frame.theme-light #view-whatsapp .wa-input-mock { background: white; border: 1px solid #ccc; }
        .phone-frame.theme-light #view-whatsapp .wa-icon { stroke: #007aff; }
        .phone-frame.theme-light .home-bar { background: black; }
        /* Light Menu */
        .phone-frame.theme-light .reaction-bar, .phone-frame.theme-light .ctx-menu { background: #fff; color: black; }
        .phone-frame.theme-light .ctx-item { border-bottom: 1px solid #eee; }
        .phone-frame.theme-light .reaction-more { background: #f0f0f0; }


        /* ELEMENTS INSIDE PHONE */
        .status-bar { position: absolute; top: 14px; width: 100%; padding: 0 25px; display: flex; justify-content: space-between; color: white; font-weight: 600; font-size: 15px; z-index: 998; }
        .status-icons { display: flex; gap: 5px; align-items: center; }
        .status-icons svg { width: 18px; height: 18px; }
        .battery { width: 27px; height: 13px; border: 1.5px solid rgba(255,255,255,0.4); border-radius: 3px; display: flex; align-items: center; position: relative; }
        .battery-fill { background: white; height: 100%; border-radius: 1.5px; }
        .battery-tip { width: 2px; height: 5px; background: rgba(255,255,255,0.4); position: absolute; right: -3.5px; top: 50%; transform: translateY(-50%); border-radius: 0 2px 2px 0; }
        #disp-batt-num { font-size: 8px; position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); color: black; }
        .dynamic-island { position: absolute; top: 8px; left: 50%; transform: translateX(-50%); width: 90px; height: 25px; background: black; border-radius: 20px; z-index: 990; }

        .screen-content { width: 100%; height: 100%; position: absolute; top: 0; left: 0; display: none; }
        .screen-content.active { display: block; }

        /* LOCK SCREEN */
        .ls-header { padding-top: 60px; text-align: center; color: white; display: flex; flex-direction: column; align-items: center; }
        .ls-date { font-size: 20px; font-weight: 400; opacity: 0.9; }
        .ls-clock { font-size: 84px; font-weight: 600; line-height: 1; letter-spacing: -2px; }
        .ls-notification { width: 90%; margin: 20px auto; background: rgba(255,255,255,0.15); backdrop-filter: blur(25px); border-radius: 18px; padding: 12px 15px; color: white; }
        .ls-icon { width: 20px; height: 20px; background: #25D366; border-radius: 5px; padding: 3px; float: left; margin-right: 8px; }
        .ls-icon svg { fill: white; width: 100%; height: 100%; }
        .home-bar { position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); width: 120px; height: 5px; background: white; border-radius: 3px; z-index: 999; }

        /* WHATSAPP */
        #view-whatsapp { background: #0b141a; }
        .wa-header { position: absolute; top: 0; width: 100%; height: 105px; background: rgba(22, 28, 33, 0.95); backdrop-filter: blur(20px); display: flex; align-items: flex-end; padding: 10px 12px; border-bottom: 1px solid #232d36; z-index: 90; }
        .wa-back-btn { display: flex; align-items: center; color: var(--accent); font-size: 17px; margin-right: 8px; }
        .wa-profile { flex: 1; display: flex; align-items: center; gap: 10px; margin-bottom: 6px; }
        .wa-pp { width: 38px; height: 38px; border-radius: 50%; overflow: hidden; background: #666; }
        .wa-info { display: flex; flex-direction: column; }
        .wa-name { font-size: 16px; font-weight: 600; color: white; line-height: 1.2; }
        .wa-status { font-size: 12px; color: #8e8e93; }
        .wa-chat-container { padding: 115px 16px 90px 16px; height: 100%; overflow-y: auto; display: flex; flex-direction: column; gap: 2px; }

        .bubble { max-width: 78%; padding: 6px 12px 8px 12px; border-radius: 16px; font-size: 16px; position: relative; line-height: 1.35; color: white; margin-bottom: 8px; box-shadow: 0 1px 0.5px rgba(0,0,0,0.13); }
        .bubble-left { align-self: flex-start; background: var(--wa-bubble-dark); border-top-left-radius: 2px; margin-left: 8px; }
        .bubble-left::before { content: ""; position: absolute; top: 0; left: -8px; width: 12px; height: 20px; background: radial-gradient(circle at 0 0, transparent 0, transparent 11px, var(--wa-bubble-dark) 11px); clip-path: polygon(0 0, 100% 0, 100% 100%); }
        .bubble-right { align-self: flex-end; background: var(--wa-green-dark); border-top-right-radius: 2px; margin-right: 8px; }
        .bubble-right::after { content: ""; position: absolute; top: 0; right: -8px; width: 8px; height: 13px; background: var(--wa-green-dark); border-bottom-left-radius: 20px; z-index: -1; }
        
        .bubble-meta { float: right; margin-left: 8px; padding-top: 6px; display: flex; align-items: center; gap: 4px; }
        .bubble-time { font-size: 11px; color: rgba(255,255,255,0.6); }

        .wa-footer { position: absolute; bottom: 0; width: 100%; height: 80px; background: #1f2c34; display: flex; align-items: flex-start; padding: 12px 15px; gap: 15px; z-index: 91; }
        .wa-input-mock { flex: 1; height: 35px; background: #2c3e50; border-radius: 18px; }

        /* --- LOGIKA MENU & BLUR (FIXED) --- */
        
        /* Overlay Gelap (Pengganti Blur CSS) */
        .wa-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.75); /* Gelap Pekat Transparan */
            opacity: 0; pointer-events: none; transition: opacity 0.2s; z-index: 200;
        }
        .wa-overlay.active { opacity: 1; pointer-events: auto; }

        /* Bubble Focus */
        .bubble.active-press { z-index: 201; transform: scale(1.01); box-shadow: none; }

        /* Reaction Bar (Emoji Images) */
        .reaction-bar {
            position: absolute; height: 48px; background: var(--ios-menu-bg); border-radius: 24px;
            display: flex; align-items: center; padding: 0 12px; gap: 4px; z-index: 202;
            animation: popIn 0.2s cubic-bezier(0.17, 0.84, 0.44, 1); box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        .reaction { width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; }
        .reaction img { width: 100%; height: 100%; display: block; filter: drop-shadow(0 1px 2px rgba(0,0,0,0.2)); }
        .reaction:hover { transform: scale(1.2); }
        
        /* Context Menu */
        .ctx-menu {
            position: absolute; width: 220px; background: var(--ios-menu-bg); border-radius: 14px;
            z-index: 202; overflow: hidden; animation: fadeUp 0.2s ease; box-shadow: 0 10px 40px rgba(0,0,0,0.6);
        }
        .ctx-item {
            padding: 14px 16px; color: white; font-size: 16px; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.12); cursor: pointer;
        }
        .ctx-item:last-child { border-bottom: none; }
        .ctx-item.danger { color: var(--danger); }
        .ctx-item svg { width: 18px; height: 18px; opacity: 1; stroke: currentColor; stroke-width: 1.5; fill: none; }

        @keyframes popIn { from { opacity: 0; transform: scale(0.5) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Responsif */
        @media (max-width: 768px) {
            .container { flex-direction: column; height: 100vh; border-radius: 0; }
            .controls { width: 100%; min-width: 100%; height: 40vh; border-right: none; border-bottom: 1px solid #333; }
            .preview { align-items: flex-start; padding-top: 20px; }
            .phone-frame { transform: scale(0.9); transform-origin: top center; }
        }
    </style>
</head>
<body>

<div class="container">
    <aside class="controls">
        <div class="header-control"><h1>IQC <span>iPhone</span></h1><p>Generator Mockup Pro</p></div>
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('lockscreen')">Lock Screen</button>
            <button class="tab-btn" onclick="switchTab('whatsapp')">WhatsApp</button>
        </div>

        <div class="panel-section">
            <h3>Status Bar</h3>
            <div class="input-row"><input type="time" id="sys-time" value="09:41"><input type="number" id="sys-battery" value="100" placeholder="%"></div>
        </div>
        <div class="panel-section">
            <h3>Tema</h3>
            <select id="sys-theme"><option value="dark">Dark Mode</option><option value="light">Light Mode</option></select>
        </div>

        <div id="panel-lockscreen" class="panel active">
            <div class="input-group"><label>Wallpaper</label><select id="ls-wallpaper"><option value="gradient1">Gradient Biru</option><option value="custom">Upload...</option></select></div>
            <div class="input-group" id="wallpaper-group" style="display:none"><input type="file" id="ls-file" accept="image/*"></div>
            <div class="input-group"><label>Isi Notif</label><textarea id="ls-msg">Kangen kamu...</textarea></div>
        </div>

        <div id="panel-whatsapp" class="panel">
            <div class="input-group"><label>Nama</label><input type="text" id="wa-name" value="Sayang"></div>
            <div class="input-group"><label>Foto</label><input type="file" id="wa-pp-input"></div>
            <div class="divider"></div>
            <div class="input-group"><label>Pesan</label><textarea id="wa-in-msg" placeholder="Ketik..."></textarea></div>
            <div class="input-row">
                <input type="time" id="wa-in-time" value="09:41">
                <select id="wa-in-pos"><option value="right">Kanan</option><option value="left">Kiri</option></select>
            </div>
            <div class="input-group" id="check-group">
                <select id="wa-in-check"><option value="read">Biru</option><option value="delivered">Abu</option></select>
            </div>
            <button class="btn-add" onclick="addChat()">Kirim Pesan</button>
            <div class="divider"></div>
            <h3>List Pesan</h3>
            <div id="msg-list" class="message-list"></div>
        </div>

        <div style="margin-top:auto">
            <button class="btn-primary" id="btn-dl">Download Gambar</button>
            <div class="copyright">&copy; 2025 IQC</div>
        </div>
    </aside>

    <main class="preview">
        <div class="phone-frame" id="capture-area">
            <div class="status-bar">
                <div id="disp-time">09:41</div><div class="dynamic-island"></div>
                <div class="status-icons">
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17,7H22V20H17V7M10,13H15V20H10V13M3,16H8V20H3V16Z"/></svg>
                    <svg viewBox="0 0 24 24" fill="currentColor"><path d="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z"/></svg>
                    <div class="battery"><div class="battery-fill" id="disp-batt" style="width:100%"></div><div class="battery-tip"></div></div>
                </div>
            </div>

            <div id="view-lockscreen" class="screen-content active" style="background:linear-gradient(180deg,#2c3e50,#000)">
                <div class="ls-header"><div class="ls-clock">09:41</div><div>Senin, 1 Jan</div></div>
                <div class="ls-notification">
                    <div style="display:flex;align-items:center;margin-bottom:5px"><div class="ls-icon"><svg viewBox="0 0 32 32"><path d="M16 0C7.164 0 0 7.164 0 16c0 2.825.738 5.477 2.028 7.772L.698 30.5l7.033-1.845A15.93 15.93 0 0016 32c8.836 0 16-7.164 16-16S24.836 0 16 0zm0 29.333c-2.455 0-4.763-.664-6.745-1.82l-.483-.287-5.01 1.314 1.338-4.888-.315-.5A13.27 13.27 0 012.667 16c0-7.364 5.97-13.333 13.333-13.333S29.333 8.636 29.333 16 23.364 29.333 16 29.333z" fill="white"/></svg></div><span style="flex:1;font-weight:600;font-size:12px">WhatsApp</span><span style="font-size:12px">Baru saja</span></div>
                    <div><strong style="display:block;font-size:14px">Sayang</strong><p id="disp-ls-msg" style="font-size:14px;margin:0">Kangen kamu...</p></div>
                </div>
                <div class="home-bar"></div>
            </div>

            <div id="view-whatsapp" class="screen-content">
                <div class="wa-header">
                    <div class="wa-back-btn"><svg width="24" height="24" viewBox="0 0 24 24" fill="#0a84ff"><path d="M11.67 3.87L9.9 2.1 0 12l9.9 9.9 1.77-1.77L3.54 12z"/></svg> 9</div>
                    <div class="wa-profile">
                        <div class="wa-pp"><img id="disp-wa-pp" src="" style="display:none;width:100%;height:100%;object-fit:cover"></div>
                        <div class="wa-info"><div class="wa-name" id="disp-wa-name">Sayang</div><div class="wa-status">Online</div></div>
                    </div>
                </div>
                <div class="wa-chat-container" id="wa-chat-list"></div>
                <div class="wa-footer">
                    <svg width="24" height="24" viewBox="0 0 24 24" stroke="#0a84ff" fill="none" stroke-width="1.5"><path d="M12 5v14M5 12h14"/></svg>
                    <div class="wa-input-mock"></div>
                </div>
                <div class="home-bar"></div>
                <div id="wa-overlay" class="wa-overlay"></div>
            </div>
        </div>
    </main>
</div>

<script>
    const emojis = [
        'https://em-content.zobj.net/source/apple/391/thumbs-up_1f44d.png',
        'https://em-content.zobj.net/source/apple/391/red-heart_2764-fe0f.png',
        'https://em-content.zobj.net/source/apple/391/face-with-tears-of-joy_1f602.png',
        'https://em-content.zobj.net/source/apple/391/face-with-open-mouth_1f62e.png',
        'https://em-content.zobj.net/source/apple/391/crying-face_1f622.png',
        'https://em-content.zobj.net/source/apple/391/folded-hands_1f64f.png'
    ];
    let chats = [];

    function init() {
        // Event Listeners
        document.getElementById('sys-time').addEventListener('input', e => {
            document.getElementById('disp-time').innerText = e.target.value;
            document.querySelector('.ls-clock').innerText = e.target.value;
        });
        document.getElementById('sys-battery').addEventListener('input', e => {
            document.getElementById('disp-batt').style.width = e.target.value + '%';
        });
        document.getElementById('ls-msg').addEventListener('input', e => document.getElementById('disp-ls-msg').innerText = e.target.value);
        document.getElementById('wa-name').addEventListener('input', e => document.getElementById('disp-wa-name').innerText = e.target.value);
        document.getElementById('wa-pp-input').addEventListener('change', e => {
            if(e.target.files[0]) {
                const url = URL.createObjectURL(e.target.files[0]);
                const img = document.getElementById('disp-wa-pp');
                img.src = url; img.style.display = 'block';
            }
        });
        document.getElementById('wa-in-pos').addEventListener('change', e => {
            document.getElementById('check-group').style.display = e.target.value === 'right' ? 'flex' : 'none';
        });
        document.getElementById('ls-wallpaper').addEventListener('change', e => {
            if(e.target.value==='custom') document.getElementById('wallpaper-group').style.display='flex';
            else {
                document.getElementById('wallpaper-group').style.display='none';
                document.getElementById('view-lockscreen').style.backgroundImage='';
            }
        });
        document.getElementById('ls-file').addEventListener('change', e => {
             if(e.target.files[0]) document.getElementById('view-lockscreen').style.background = `url(${URL.createObjectURL(e.target.files[0])}) center/cover`;
        });
        document.getElementById('sys-theme').addEventListener('change', e => {
            const f = document.getElementById('capture-area');
            if(e.target.value==='light') f.classList.add('theme-light'); else f.classList.remove('theme-light');
        });
        document.getElementById('btn-dl').addEventListener('click', download);
        document.getElementById('wa-overlay').addEventListener('click', closeMenu);
    }

    function switchTab(mode) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        event.target.classList.add('active');
        document.querySelectorAll('.panel, .screen-content').forEach(el => el.classList.remove('active'));
        document.getElementById('panel-'+mode).classList.add('active');
        document.getElementById('view-'+mode).classList.add('active');
    }

    function addChat() {
        const txt = document.getElementById('wa-in-msg').value;
        if(!txt) return;
        chats.push({
            id: Date.now(), text: txt,
            time: document.getElementById('wa-in-time').value,
            pos: document.getElementById('wa-in-pos').value,
            check: document.getElementById('wa-in-check').value
        });
        renderChats();
        document.getElementById('wa-in-msg').value = '';
    }

    function renderChats() {
        const cont = document.getElementById('wa-chat-list');
        const list = document.getElementById('msg-list');
        cont.innerHTML = ''; list.innerHTML = '';
        
        chats.forEach(c => {
            // Preview Bubble
            const b = document.createElement('div');
            b.className = `bubble bubble-${c.pos}`;
            b.id = `chat-${c.id}`;
            let tick = '';
            if(c.pos === 'right') {
                const col = c.check === 'read' ? '#53bdeb' : '#8696a0';
                if(c.check === 'sent') tick = `<svg viewBox="0 0 24 24" fill="none" stroke="${col}" stroke-width="2" style="width:16px;height:16px"><polyline points="20 6 9 17 4 12"/></svg>`;
                else tick = `<div style="position:relative;width:16px;height:12px"><svg viewBox="0 0 24 24" fill="none" stroke="${col}" stroke-width="2" style="width:16px;position:absolute;left:0"><polyline points="20 6 9 17 4 12"/></svg><svg viewBox="0 0 24 24" fill="none" stroke="${col}" stroke-width="2" style="width:16px;position:absolute;left:4px"><polyline points="20 6 9 17 4 12"/></svg></div>`;
            }
            b.innerHTML = `${c.text}<div class="bubble-meta"><span class="bubble-time">${c.time}</span>${tick}</div>`;
            cont.appendChild(b);

            // List Item
            const li = document.createElement('div'); li.className = 'list-item';
            li.innerHTML = `<span>${c.text.substring(0,15)}...</span><div><button style="margin-right:5px" onclick="openMenu(${c.id})">ðŸ‘†</button><button style="color:red" onclick="delChat(${c.id})">âœ•</button></div>`;
            list.appendChild(li);
        });
    }

    function delChat(id) { chats = chats.filter(c => c.id !== id); closeMenu(); renderChats(); }

    function openMenu(id) {
        closeMenu();
        const b = document.getElementById(`chat-${id}`);
        if(!b) return;
        
        document.getElementById('wa-overlay').classList.add('active');
        b.classList.add('active-press');
        
        const container = document.getElementById('wa-chat-list');
        const top = b.offsetTop;
        const isRight = b.classList.contains('bubble-right');

        // Reaction Bar
        const r = document.createElement('div'); r.className = 'reaction-bar temp-ui';
        let eHtml = ''; emojis.forEach(u => eHtml += `<div class="reaction"><img src="${u}"></div>`);
        r.innerHTML = eHtml + `<div class="reaction reaction-more"><svg viewBox="0 0 24 24"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></div>`;
        r.style.top = (top - 55) + 'px';
        if(isRight) { r.style.right = '15px'; r.style.transformOrigin = 'bottom right'; } else { r.style.left = '15px'; r.style.transformOrigin = 'bottom left'; }
        container.appendChild(r);

        // Context Menu
        const m = document.createElement('div'); m.className = 'ctx-menu temp-ui';
        m.innerHTML = `
            <div class="ctx-item">Balas <svg viewBox="0 0 24 24"><path d="M9 14L4 9l5-5M4 9h10c4 0 7 3 7 7v1"/></svg></div>
            <div class="ctx-item">Teruskan <svg viewBox="0 0 24 24"><path d="M15 14l5-5-5-5M4 20v-1c0-4 3-7 7-7h9"/></svg></div>
            <div class="ctx-item">Salin <svg viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg></div>
            <div class="ctx-item">Info <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg></div>
            <div class="ctx-item danger" onclick="delChat(${id})">Hapus <svg viewBox="0 0 24 24"><path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></div>
        `;
        m.style.top = (top + b.offsetHeight + 10) + 'px';
        if(isRight) { m.style.right = '15px'; m.style.transformOrigin = 'top right'; } else { m.style.left = '15px'; m.style.transformOrigin = 'top left'; }
        container.appendChild(m);
    }

    function closeMenu() {
        document.getElementById('wa-overlay').classList.remove('active');
        document.querySelectorAll('.active-press').forEach(e => e.classList.remove('active-press'));
        document.querySelectorAll('.temp-ui').forEach(e => e.remove());
    }

    function download() {
        const btn = document.getElementById('btn-dl');
        const txt = btn.innerText;
        btn.innerText = 'Memproses...';
        setTimeout(() => {
            html2canvas(document.getElementById('capture-area'), { scale: 2, backgroundColor: null, useCORS: true }).then(c => {
                const a = document.createElement('a');
                a.download = 'IQC-iPhone.png'; a.href = c.toDataURL(); a.click(); btn.innerText = txt;
            });
        }, 100);
    }

    init();
</script>

</body>
</html>
